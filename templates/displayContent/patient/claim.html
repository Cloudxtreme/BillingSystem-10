{% extends "base.html" %}
{% load widget_tweaks %}
{% load staticfiles %}

    {% block title %} Claim Details {% endblock title %}

    {% block script %}

        
    {% endblock script %}
    {% block link %}
    {% endblock link %}


{% block body %}

<div class="container-fluid" style=" max-width:1400px">
    <div class="col-xs-6" style="padding-right:20px; border-right: 1px solid #ccc;">
        <h3 class="text-center">Claim Searches</h3>

        <table id="table_search" class="table table-condensed table-hover">
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Created</th>
                    <th>Patient Name</th>
                    <th>$ Charge</th>
                </tr>
            </thead>
            <tbody>
                {% for ele in claimSearches %}
                    <tr>
                        <td>idk</td>
                        <td>{{ele.created}}</td>
                        <td>{{patient_info.last_name}}, {{patient_info.first_name}}</td>
                        <td>{{ele.total_charge}}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

            {{claimSearches}}
    </div>
    <div class="col-xs-6">
        <h3 class="text-center">Claim Details</h3>
            <h4>Payment Summary</h4>
            <div class="row" style="margin: 0px 5px;">
                <table class="table table-striped table-condensed found-table" style="margin-bottom: 0px;">
                    <thead>
                        <tr>
                            <th>Total Charge</th>
                            <th>Inc Pmnt</th>
                            <th>Adjustments</th>
                            <th>Inc Balance</th>
                            <th>Pat Resp</th>
                            <th>Pat Pmnt</th>
                            <th>Total Bal</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ele in claimSearches %}
                            <tr>
                                <td>{{ele.total_charge}}</td>
                                <td>{{ele.ins_pmnt}}</td>
                                <td>{{ele.ins_adjustment}}</td>
                                <td>{{ele.inc_balance}}</td>
                                <td>{{ele.pat_responsible}}</td>
                                <td>{{ele.pat_pmnt}}</td>
                                <td>{{ele.total_balance}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>    
                </table>
            </div>


    </div>
</div>

<script>

$("#table_search tbody tr").on("click", function(){
    console.log(123);
})

<script type="text/template" class="found-payment-template">
    <div class="row" style="margin: 0px 5px;">
        <table class="table table-striped table-condensed found-table" style="margin-bottom: 0px;">
            <thead>
                <tr>
                    <th>Total Charge</th>
                    <th>Inc Pmnt</th>
                    <th>Adjustments</th>
                    <th>Inc Balance</th>
                    <th>Pat Resp</th>
                    <th>Pat Pmnt</th>
                    <th>Total Bal</th>
                </tr>
            </thead>
            <tbody>
                <% _.each(patients, function(patients, i) { var p = patients.fields; console.log(p) %>
                <tr class="found-payment-item" data-payment-index="<%- i %>">
                    <td><a href="/payment/<%= p.chart_no %>" ><%= p.chart_no %></a></td>
                    <td><%= p.first_name %></td>
                    <td><%= p.last_name %></td>
                    <td><%= p.dob %></td>
                    <td><%= p.ssn %></td>
                    <td><%= p.home_phone %></td>
                    <td><%= p.get_primary_insurane %></td>
                </tr>
                <% }); %>
            </tbody>
        </table>
        <% if(patients.length < 1) { %>
        <h4 class="text-center not-found">The search did not match any patients.</h4>
        <% } %>
    </div>
</script>


<script>
    $('.search-modal').click(function(e) {
        var button = e.currentTarget;
        var type = $(button).data('type');
        // toggleLoadingIcon(button);
         
        var form = $(e.currentTarget).closest('form');
        $.post(form.attr('action'), form.serialize())
            .done(function(objects) {
                // Append search result into Modal
                var foundObjectTemplate = _.template($('script.found-' + type + '-template').html(), {variable: type+'s'});
                $('#found-' + type).html(foundObjectTemplate(objects));
            })
            .fail(function() {
                $('#found-' + type).html(`
                    <h4 class="text-center not-found">An unexptected error has occured, please try again later.</h4>
                `);
            })
            .always(function() {
                // toggleLoadingIcon(button);
            });
    });


</script>

</script>

{% endblock body %}