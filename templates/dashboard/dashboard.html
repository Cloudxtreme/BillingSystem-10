{% extends "base.html" %}

{% load staticfiles %}

{% block link %}

<style>
    a{
        margin-left: 5px;
    }
    table#notes_table{
        display : block;
        width : 100%;
        height: inherit;
        max-height: 200px;
        /*overflow-y: scroll;*/
    }
/*    table#notes_table tbody#note-body td {
        width: inherit;
        word-wrap:break-word;
    }*/
    table#notes_table tbody#note-body{
        width: inherit;
        display: table;
    }
    table#notes_table thead{
        width: inherit;
        display: table;
    }
    div#table_div{
        overflow-y: scroll;
    }
    
</style>

{% endblock link %}

{% block body %}

<div class="container">

    <div class="row">
        <a href="{% url 'accounting:payment_apply_read' %}" class="btn btn-info pull-right">Apply Payment</a>
        <a href="{% url 'accounting:payment_create' %}" class="btn btn-primary pull-right">Make Payment</a>
        <a href="{% url 'accounting:gross_payment_summary' %}" class="btn btn-danger pull-right">Payment summary (gross)</a>
        <a href="{% url 'displayContent:view_dashboard' %}" class="btn btn-success pull-right">Patient Dashboard</a>
        <a href="{% url 'accounting:claim_summary' %}" class="btn btn-info pull-right">Claim Summary</a>
        <a href="{% url 'admin:accounting_payment_changelist' %}" class="btn btn-primary pull-right">Payment received Summary</a>
        <a href="{% url 'admin:accounting_apply_changelist' %}" class="btn btn-danger pull-right">Apply Payment Summary</a>

    </div>


    <br>
    <div class="jumbotron" >
        <h1>Dashboard</h1>
        <p style="display:none">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </div>

    <h4>Notes</h4>
    <div id="table_div">
        <table id="notes_table" class="table table-striped table-condensed">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Entered By</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="note-body"></tbody>
        </table>
    </div>
    <div class="row">
        <form method="POST" action="{% url 'dashboard:api_create_note' %}" id="form-note-create">{% csrf_token %}
            <div class="col-sm-10">
                Add Note: 
                <input type="text" name="desc" id="desc" class="form-control" style="display: inline-block; width: 80%;" required >
            </div>
            <div class="col-sm-2"><input type="submit" class="btn btn-block btn-default" value="Save"></div>
        </form>
    </div>


</div>

<script type="text/template" class="notes-template">
    <% if(notes.length < 1) { %>
        <tr>
            <td colspan="100" class="text-center not-found">There are no notes on the dashboard yet! </td>
        </tr>
    <% } else {
        _.each(notes, function(note, i) {
            var n = note.fields;
            var dt = moment(n.created);
    %>
        <tr>
            <td><%= n.desc %></td>
            <td><%= n.author.first_name %></td>
            <td><%= dt.format('MM/DD/YYYY hh:mm A') %></td>
        </tr>
    <% }); } %>
</script>

<script>
'use strict';
(function() {
    var form = $('#form-note-create');
    form.submit(function(e) {
        e.preventDefault();
        var form = $(e.currentTarget);
        $.post(form.attr('action'), form.serialize())
            .done(function(data) {
                $("#desc").val("");
                renderNotesDetailsTemplate();

            })
            .fail(function(error) {
                console.log('failure');
            });
    });
})();
</script>

<script>
function renderNotesDetailsTemplate() {
    var notesTemplate =
            _.template($('script.notes-template').html());
    var notesBody = $('#note-body')
    $.get("{% url 'dashboard:api_create_note' %}?get=1")
        .done(function(data) {
            console.log("getting stuff for notes!. in done@@! ");
            notesBody.html(notesTemplate({
                    err: false,
                    notes: data.notes}));
            var elem = document.getElementById('table_div');
            elem.scrollTop = elem.scrollHeight;
        })
        .fail(function() {
            notesBody.html(
                `<td colspan="100" class="text-center not-found">
                An unexpected error has occured.  Please try again later!!.
                </td>`);
        })
        .always(function() {
        })
    }
</script>
<script>

$(document).ready(function () {
    renderNotesDetailsTemplate();
})
</script>


{% endblock body %}
