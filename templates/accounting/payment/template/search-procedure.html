<div class="row" id="procedure-table">
    <table class="table table-striped table-condensed">
        <thead>
            <tr>
                <th>Date of Service</th>
                <th>CPT Code</th>
                <th>Line Charge</th>
                <th>Balance</th>
                <th>Payment</th>
                <th>Adjustment</th>
                <th>Reference</th>
            </tr>
        </thead>
        <tbody class="row found-procedure" id="found-procedure">
            <tr>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </tbody>
    </table>
</div>


<script type="text/template" class="found-procedure-template">
    <%
    _.each(procedures, function(procedure, i) {
        var p = procedure.fields;
        var balance = parseFloat(p.charge);
        for(var ap of p.appliedPayment) {
            balance = balance - parseFloat(ap.amount) + parseFloat(ap.adjustment);
            var dos = moment(p.date_of_service, 'YYYY-MM-DD');
        }
        console.log('here');
    %>
    <tr class="found-procedure-item" data-procedure-id="<%- procedure.pk %>" data-procedure-index="<%- i %>">
        <td><%= dos.format('MM/DD/YYYY') %></td>
        <td><%= p.cpt %></td>
        <td><%= p.charge %></td>
        <td><%= balance.toFixed(2) %></td>
        <td><input type="text" class="form-control" name="payment"></td>
        <td><input type="text" class="form-control" name="adjustment"></td>
        <td><input type="text" class="form-control" name="reference"></td>
    </tr>
    <% }); %>
</script>
