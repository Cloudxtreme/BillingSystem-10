{% load bootstrap %}
{% load staticfiles %}
<script type="text/javascript" src="{% static 'infoGatherer/jquery-2.2.0.min.js' %}"></script>
<script type="text/javascript" src="{% static 'infoGatherer/jquery.autocomplete.min.js' %}"></script>
<script type="text/javascript" src="{% static 'infoGatherer/jquery.cookie.js' %}"></script>

<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

{% comment %}

This is the display for the 'Post Ad' form.

URL: postad/  
Model: PostAd  
ModelForm: PostAdForm  
View: PostAdPage [FormView]  
View Return: HttpResponse : message - "Sweeeeeeeet."

* = preset when user is logged in.

{% endcomment %}

<body>
<div class="container">
{% block content %}
<form action="info/postad/" method="post" id="make-claims-form">
    {% csrf_token %}
    <br/>
    <strong>Patient:</strong>
    <br/><br/>
    <!-- *Health Plan -->
    <div class="fieldWrapper">
        {{ form.health_plan.errors }}
        <label for="id_healthplan">Health Plan</label>
        {{ form.health_plan }}
    </div>
    <!-- *Patients name -->
    <div class="fieldWrapper" id="searchField">
        {{ form.pat_name.errors }}
        <label for="id_patientname">Patient's name</label>
        {{ form.pat_name }}
        <input type="hidden" name="patient_chart_no" id="patient_chart_no" data-patient-chart-no>
    </div>
    <!-- *Patients Address -->
    <div class="fieldWrapper">
        {{ form.pat_streetaddress.errors }}
        <label for="id_patientstreetaddress">Patient's Address</label>
        {{ form.pat_streetaddress }}
        <label for="id_patientcity"></label>
        {{ form.pat_city }}
        <label for="id_state"></label>
        {{ form.pat_state }}
        <label for="id_zip"></label>
        {{ form.pat_zip }}
    </div>
    <div class="fieldWrapper" >
        {{ form.pat_telephone.errors }}
        <label for="id_telephone">Phone No.</label>
        {{ form.pat_telephone }}
    </div>
    <!-- Birth Date -->
    <div class="fieldWrapper">
        {{ form.birth_date.errors }}
        <label for="id_birthdate">Birth Date</label>
        {{ form.birth_date }}
    </div>
    <!-- *Patient sex -->
    <div class="fieldWrapper">
        {{ form.pat_sex.errors }}
        <label for="id_patientsex">Patient's sex</label>
        {{ form.pat_sex }}
    </div>
    <!-- *Patient Relationship to Insured -->
    <div class="fieldWrapper">
        {{ form.pat_relationship.errors }}
        <label for="id_patientrelationshiptoinsured">Patient's Relationship to Insured</label>
        {{ form.pat_relationship }}
    </div>
    <!-- Others insured name -->
    <div class="fieldWrapper">
        {{ form.pat_other_insured_name.errors }}
        <label for="id_patientotherinsured">Other Insured's Name</label>
        {{ form.pat_other_insured_name }}
    </div>
    <div class="fieldWrapper">
        {{ form.pat_other_insured_policy.errors }}
        <label for="id_patientotherinsured">Other Insured's Policy/Group Number</label>
        {{ form.pat_other_insured_policy }}
    </div>
    <div class="fieldWrapper">
        {{ form.pat_reserved_nucc1.errors }}
        <label for="id_reservednucc1">Reserved for NUCC use</label>
        {{ form.pat_reservednucc1 }}
        <label for="id_reservednucc2"></label>
        {{ form.pat_reservednucc2 }}
        <label for="id_reservednucc3"></label>
        {{ form.pat_reservednucc3 }}
    </div>
    <!-- Insurance plan name or program name -->
    <div class="fieldWrapper">
        {{ form.pat_insuranceplanname.errors }}
        <label for="id_insuranceplanname">Insurance plan name or program name</label>
        {{ form.pat_insuranceplanname }}
    </div>
    <div class="fieldWrapper">
        Is Patients Condition related to: 
        {{ form.pat_relation_emp.errors }}
        <label for="id_relation_emp">Emploment?</label>
        {{ form.pat_relation_emp }}
        <label for="id_relation_auto_accident">Auto Accident?</label>
        {{ form.pat_relation_auto_accident }}
        <label for="id_relation_other_accident">Other Accident?</label>
        {{ form.pat_relation_other_accident }}
    </div>
    <div class="fieldWrapper">
        {{ form.claim_codes.errors }}
        <label for="id_claim_codes">Claim Codes</label>
        {{ form.claim_codes }}
    </div>


    <br/>
    <strong>Insured:</strong>
    <br/><br/>





    <!-- Insured id number -->
    <div class="fieldWrapper">
        {{ form.insured_idnumber.errors }}
        <label for="id_idnumber">Insured id number</label>
        {{ form.insured_idnumber }}
    </div>
    <!-- *insured name -->
    <div class="fieldWrapper">
        {{ form.insured_name.errors }}
        <label for="id_insuredname">Insured's name</label>
        {{ form.insured_name }}
    </div>
    <!-- *insured Address -->
    <div class="fieldWrapper">
        {{ form.insured_streetaddress.errors }}
        <label for="id_insuredstreetaddress">Insured's Address</label>
        {{ form.insured_streetaddress }}
        <label for="id_insuredcity"></label>
        {{ form.insured_city }}
        <label for="id_insuredstate"></label>
        {{ form.insured_state }}
        <label for="id_insuredzip"></label>
        {{ form.insured_zip }}
    </div>
    <div class="fieldWrapper">
        {{ form.insured_telephone.errors }}
        <label for="id_insuredtelephone">Phone No.</label>
        {{ form.insured_telephone }}
    </div>
    <div class="fieldWrapper">
        {{ form.insured_other_insured_policy.errors }}
        <label for="id_patientotherinsured">Insured's Policy/Group Number</label>
        {{ form.insured_other_insured_policy }}
    </div>
    <!-- Birth Date -->
    <div class="fieldWrapper">
        {{ form.insured_birth_date.errors }}
        <label for="id_insured_birthdate">Insured's Birth Date</label>
        {{ form.insured_birth_date }}
    </div>
    <!-- *Insured sex -->
    <div class="fieldWrapper">
        {{ form.insured_sex.errors }}
        <label for="id_insuredsex">Insured's sex</label>
        {{ form.insured_sex }}
    </div>
    <div class="fieldWrapper">
        {{ form.other_cliam_id.errors }}
        <label for="id_other_claim_id">Other claim id</label>
        {{ form.other_cliam_id }}
    </div>
    <div class="fieldWrapper">
        {{ form.insured_plan_name_program.errors }}
        <label for="id_other_claim_id">Insurance plan name or program name</label>
        {{ form.insured_plan_name_program }}
    </div>
    <div class="fieldWrapper">
        {{ form.insured_other_benifit_plan.errors }}
        <label for="id_other_claim_id">Is there another health benifit plan?</label>
        {{ form.insured_other_benifit_plan }}
    </div>
    <br/>
    <button type="submit">
        <i class="fa fa-thumb-tack"></i> Print Please!
    </button>
</form>
{% endblock %}

<script>
    $(function() {

        $('#make-claims-form').submit(function(e) {
            return false;
        });

        var csrftoken = $.cookie('csrftoken');

        function csrfSafeMethod(method) {
            // these HTTP methods do not require CSRF protection
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        $.ajax({
            url: "{% url 'infoGatherer:get_make_claim_extra_context' %}",
        }).done(function(data) {
            var jObj = JSON.parse(data);
            var patient_list = jObj.patient_list;
            var patient_list_obj = [];

            for(var patient of patient_list)
                patient_list_obj.push({value: patient.first_name + " " + patient.last_name, data: patient.chart_no})

            $("#id_pat_name").autocomplete({
                lookup: patient_list_obj,
                onSelect: function (suggestion) {
                    $.post(
                        "{% url 'infoGatherer:get_json_personal_information' %}",
                        {patient_chart_no: suggestion.data},
                        function(patient_info_str) {
                            var patient_info = JSON.parse(patient_info_str)[0];
                            
                            $("#id_pat_streetaddress").val(patient_info.address);
                            $("#id_pat_city").val(patient_info.city);
                            $("#id_pat_state").val(patient_info.state);
                            $("#id_pat_zip").val(patient_info.zip);

                            $("#id_pat_telephone").val(patient_info.home_phone);

                            var birth_date_str = patient_info.dob.substr(0,4) + "/" + patient_info.dob.substr(5,2) + "/" + patient_info.dob.substr(8,2)

                            $("#id_birth_date").val(birth_date_str);
                            $("#id_pat_sex").val(patient_info.sex.substr(0,1));
                        }
                    );
                }
            });
        });
    });
</script>

<style type="text/css">
    .autocomplete-suggestions { border: 1px solid #999; background: #fff; cursor: default; overflow: auto; }
    .autocomplete-suggestion { padding: 10px 5px; font-size: 1.2em; white-space: nowrap; overflow: hidden; }
    .autocomplete-selected { background: #f0f0f0; }
    .autocomplete-suggestions strong { font-weight: normal; color: #3399ff; }

    #searchfield form {
        display: inline-block;
        background: #eeefed;
        padding: 0;
        margin: 0;
        padding: 5px;
        border-radius: 3px;
        margin: 5px 0 0 0;
    }
    #searchfield form .biginput {
        width: 600px;
        height: 40px;
        padding: 0 10px 0 10px;
        background-color: #fff;
        border: 1px solid #c8c8c8;
        border-radius: 3px;
        color: #aeaeae;
        font-weight:normal;
        font-size: 1.5em;
        -webkit-transition: all 0.2s linear;
        -moz-transition: all 0.2s linear;
        transition: all 0.2s linear;
    }
    #searchfield form .biginput:focus {
        color: #858585;
    }

</style>